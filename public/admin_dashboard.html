<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>HelloGrade Admin Dashboard</title>
    
        <!-- Global Styles -->
        <link rel="stylesheet" href="css/styles.css">
    
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    
        <!-- Font Awesome Icons -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <style>
            /* General Upload Section Styles */

            #progressContainer {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
}

progress {
    appearance: none;
    -webkit-appearance: none;
    height: 20px;
    border-radius: 10px;
    overflow: hidden;
    background-color: #f3f3f3;
}

progress::-webkit-progress-bar {
    background-color: #f3f3f3;
}

progress::-webkit-progress-value {
    background-color: #2563EB;
}

progress::-moz-progress-bar {
    background-color: #2563EB;
}

.upload-section {
    margin: 20px;
    font-family: 'Poppins', sans-serif;
}

/* Tab Navigation Styles */
.tabs {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    border-bottom: 2px solid #ccc;
}

.tabs .tab-link {
    padding: 10px 20px;
    cursor: pointer;
    border: 1px solid #ccc;
    border-bottom: none;
    background-color: #f8f8f8;
    margin-right: 5px;
    transition: background-color 0.3s ease;
}

.tabs .tab-link.active {
    background-color: #2563EB;
    color: white;
    border-bottom: 2px solid white;
}

/* Tab Content Styles */
.tab-content {
    padding: 20px;
    border: 1px solid #ccc;
    background-color: #fff;
}

.tab {
    display: none;
}

.tab.active {
    display: block;
}

/* Form Styles */
form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

button {
    padding: 10px;
    background-color: #2563EB;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background-color: #1D4ED8;
}

input[type="file"] {
    padding: 5px;
}


            /* Global Styles for Consistency */
            body {
                background-color: #f0f0f0; /* Set to your desired background color */
                color: #000; /* Set to your desired text color */
                padding: 0;
                margin: 0;
                font-family: 'Poppins', sans-serif;
                height: 100vh;
                overflow: hidden;
            }
                
            .sidebar {
                background-color: #1E3A8A; /* Sidebar color */
                width: 200px;
                color: #fff;
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                padding-top: 60px;
                display: flex;
                flex-direction: column;
                justify-content: space-between; /* Space between items to move the footer to the bottom */
                box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
                z-index: 10;
            }
    
            .sidebar-welcome h2 {
                padding: 20px;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.3);
                border-top: 1px solid rgba(255, 255, 255, 0.3);
            }

            .sidebar-nav {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

            .sidebar-nav li {
                margin: 10px 0; /* Reduce margin for compact look */
                padding-left: 20px;
            }

            .sidebar-nav li a {
                color: #fff;
                text-decoration: none;
                font-size: 18px;
                display: block;
                padding: 10px;
            }

            .hidden {
                display: none;
            }

            .sidebar-nav li a.active {
                background-color: #2563EB;
                color: white;
            }


            .sidebar-nav li a:hover {
                text-align: center;
                background-color: rgba(255, 255, 255, 0.2);
            }

            .sidebar-footer {
                padding: 10px 20px;
                text-align: center;
                color: #fff;
                font-size: 0.9em;
                border-top: 1px solid rgba(255, 255, 255, 0.3);
            }

        header {
            background-color: #1E3A8A;
            color: #fff;
            width: calc(100% - 200px); /* Adjust for sidebar width */
            margin-left: 200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            position: fixed;
            top: 0;
            height: 60px;
            z-index: 1000;
        }
    
        header h1 {
            font-size: 1.5em;
            margin: 0;
        }
    
        header nav ul {
            list-style-type: none;
            display: flex;
            gap: 15px;
            margin: 0;
            padding: 0;
        }
    
        header nav ul li a {
            color: #fff;
            font-size: 1.5em;
            text-decoration: none;
        }
    
        .content {
            margin-left: auto; /* Sidebar width */
            padding: 20px;
            width: calc(100% - 200px); /* Full width minus sidebar */
            min-height: calc(100vh - 60px); /* Account for header height */
            display: flex;
            box-sizing: border-box;
            overflow: auto;
            flex-direction: column;
            justify-content: flex-start;
            flex-wrap: wrap;
            align-items: flex-start; /* Align items to the top */
            overflow-y: auto; /* Allow scrolling if content overflows */
            background-color: #f4f4f4; /* Light background for contrast */
        }
        /* Add a container for centering content */
        .content-inner {
            margin-block-end: auto;
            width: 100%;
            max-width: 1200px; /* Restrict maximum width for readability */
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }      

        /* General Styling for Main Content Sections */
main,
.content-section {
    margin-left: 200px; /* Adjust for sidebar width */
    padding: 20px;
    width: calc(100% - 200px); /* Full width minus sidebar */
    min-height: calc(100vh - 60px); /* Account for header height */
    display: flex;
    box-sizing: border-box;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    overflow-y: auto; /* Allow scrolling if content overflows */
    background-color: #f4f4f4; /* Light background for contrast */
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add a slight shadow for visual depth */
}

/* Inner Content Wrapper for Consistent Padding */
.content-inner {
    width: 100%;
    max-width: 1200px; /* Restrict maximum width for readability */
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Hidden Class for Hiding Sections */
.hidden {
    display: none;
}

            
            .table-container {
                overflow-x: auto;
                width: 100%;
                margin-top: 10px; /* Align the table closely with the search bar */
            }
    
            .results-table {
                width: 100%;
                border-collapse: collapse;
                background-color: rgba(255, 255, 255, 0.1);
                border-radius: 8px;
            }
    
            .results-table th, .results-table td {
                padding: 12px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                text-align: center;
            }
    
            .results-table th {
                background-color: #2563EB;
                color: #fff;
            }
    
        /* Alternating row colors */
        .results-table tr:nth-child(odd) {
            background-color: #f2f2f2; /* Light grey */
        }

        .results-table tr:nth-child(even) {
            background-color: #e0e7ff; /* Light blue */
        }
    
            .no-results {
                text-align: center;
                margin-top: 20px;
                font-size: 1.2em;
                color: #888;
            }
            #studentID {
                text-align: center;
                font-size: 0.9em;
                color: #ccc;
                margin-top: 5px;
                display: block; /* Ensure it takes up the full line for centering */
                }


             /* Adjustments for smaller screens */
    @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                max-width: 100%; /* Full width on smaller screens */
                border-radius: 25px; /* Full rounded corners */
                margin-bottom: 8px; /* Space below input */
            }

            .search-button {
                max-width: 100%; /* Full width on smaller screens */
                border-radius: 25px; /* Full rounded corners */
            }

            .pagination {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }

            .pagination button {
                background-color: #2563EB;
                color: white;
                border: none;
                margin: 0 5px;
                padding: 8px 12px;
                cursor: pointer;
                border-radius: 5px;
                font-size: 1em;
            }

            .pagination button.active {
                background-color: #1D4ED8;
            }

            .pagination button:hover {
                background-color: #1E40AF;
            }

            .pagination button[disabled] {
                background-color: #CCCCCC;
                cursor: not-allowed;
            }

        }
        </style>
    </head>
    <body>
        <header>
            <h1>HelloGrade Admin Dashboard</h1>
            <nav>
                <ul>
                    <li><a href="#" title="Account Settings"><span class="material-icons">settings</span></a></li>
                    <li><a href="#" title="Help"><span class="material-icons">help_outline</span></a></li>
                    <li><a href="#" id="logoutLink" title="Logout"><span class="material-icons">logout</span></a></li>
                    <li><a href="#" id="" title="Logout"><span class="material-icons">logout</span></a></li>
                </ul>
            </nav>
            
        </header>
        <!-- Main Content -->
        <main id="dashboardSection">
            <div class="content">
                <div class="content-inner">
                    <div style="height: 50px;"></div> <!-- Spacer div -->
                    <h2>Dashboard</h2>
                    <div class="search-container">
                        <input type="text" id="searchInput" class="search-input" placeholder="Search by student ID, name, course ID, etc.">
                        <button id="searchButton" class="search-button">Search</button> 
                        <p>Welcome to the Dashboard!</p>
                    </div>
            <div class="table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Course ID</th>
                            <th>Course Description</th>
                            <th>Midterm Grade</th>
                            <th>Transmuted Midterm Grade</th> <!-- New Column -->
                            <th>Final Grade</th>
                            <th>Total Final Grade</th> <!-- New Column -->
                        </tr>
                    </thead>
                    <tbody id="searchResults">
                        <!-- Dynamic Results Here -->
                    </tbody>
                </table>
            </div>
            </div>
            <div class="pagination" id="pagination"></div>
            </div>
                        <!-- Google AdSense Ad Code Above Footer -->
    <div class="ad-above-footer" style="text-align: center; margin: 20px 0;">
        <!-- left panel -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4537208011192461"
             data-ad-slot="1206064674"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </div>

        </main>

        <div id="addGradesSection" class="content-section hidden">
            <div class="content-inner">
                <h2>Add Grades</h2>
                <div class="upload-section">
                    <!-- Tab Navigation -->
                    <ul class="tabs">
                        <li class="tab-link active" data-tab="grades-upload">Grades</li>
                        <li class="tab-link" data-tab="attendance-upload">Attendance</li>
                        <li class="tab-link" data-tab="classstanding-upload">Class Standing</li>
                    </ul>
        
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <div id="grades-upload" class="tab active">
                            <h3>Upload Grades</h3>
                            <form id="uploadForm" enctype="multipart/form-data">
                                <input type="file" name="gradesFile" accept=".csv, .xlsx" required />
                                <button type="submit">Upload Grades</button>
                            </form>
                            <div id="progressContainer" style="display: none; margin-top: 10px;">
                                <progress id="uploadProgress" value="0" max="100" style="width: 100%;"></progress>
                                <p id="progressText" style="text-align: center; margin-top: 5px;">0%</p>
                            </div>
                        </div>
                        <div id="attendance-upload" class="tab">
                            <h3>Upload Attendance</h3>
                            <form id="attendanceUploadForm" enctype="multipart/form-data">
                                <label for="termInput">Term:</label>
                                <input type="text" id="termInput" name="term" placeholder="Enter term (e.g., 'Fall 2024')" required />
                                <input type="file" name="attendanceFile" accept=".csv, .xlsx" required />
                                <button type="submit">Upload Attendance</button>
                            </form>
                            <div id="attendanceProgressContainer" style="display: none; margin-top: 10px;">
                                <progress id="attendanceUploadProgress" value="0" max="100" style="width: 100%;"></progress>
                                <p id="attendanceProgressText" style="text-align: center; margin-top: 5px;">0%</p>
                            </div>
                        </div>
                        
                        
                        <div id="classstanding-upload" class="tab">
                            <h3>Upload Class Standing</h3>
                            <form id="classStandingUploadForm" enctype="multipart/form-data">
                                <input type="file" name="classStandingFile" accept=".csv, .xlsx" required />
                                <button type="submit">Upload Class Standing</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="reportsSection" class="content-section hidden">
            <div class="content-inner">
                <h2>Reports</h2>
                <p>View reports here.</p>
            </div>
        </div>
        
        <div class="sidebar">
            <!-- Welcome Message at the Top of Sidebar -->
            <div class="sidebar-welcome">
                <h2>Hello, <span id="studentName">[User's Name]</span>!</h2>
                <p id="studentID" style="font-size: 0.9em; color: #ccc; margin-top: 5px;">[Admin ID]</p>
            </div>

                <ul class="sidebar-nav">
                    <li><a href="#" id="dashboardLink">Dashboard</a></li>
                    <li><a href="#" id="addGradesLink">Add Grades</a></li>
                    <li><a href="#" id="reportsLink">Reports</a></li>       
                </ul>
                
                 <!-- Footer in the Sidebar -->
        <div class="sidebar-footer">
            
            <p>&copy; 2024 HelloGrade</p>
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchGrades();
            await initializePage();
        });

        async function initializePage() {
            try {
                const sessionResponse = await fetch('/session-check', {
                    method: 'GET',
                    credentials: 'include'
                });

                const sessionData = await sessionResponse.json();
                console.log('Session check response:', sessionData); // Debug

                if (!sessionResponse.ok || !sessionData.authenticated || sessionData.role !== 'admin') {
                    console.error('Access denied:', sessionData);
                    window.location.href = sessionData.authenticated ? '403.html' : 'login.html';
                    return;
                }

                const userDetailsResponse = await fetch('/user-details', {
                    method: 'GET',
                    credentials: 'include'
                });

                const userDetails = await userDetailsResponse.json();
                if (userDetails.success) {
                    document.getElementById('studentName').textContent = `${userDetails.user.firstName} ${userDetails.user.lastName}`;
                    document.getElementById('studentID').textContent = userDetails.user.studentIDNumber;
                    // Define studentIDNumber for use in fetchGrades()
                    window.studentIDNumber = userDetails.user.studentIDNumber;
                } else {
                    console.error('Failed to fetch user details:', userDetails.message);
                }
            } catch (error) {
                console.error('Error during validation or fetching user details:', error);
                window.location.href = 'login.html';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const dashboardLink = document.getElementById('dashboardLink');
            const addGradesLink = document.getElementById('addGradesLink');
            const reportsLink = document.getElementById('reportsLink');

            const dashboardSection = document.getElementById('dashboardSection');
            const addGradesSection = document.getElementById('addGradesSection');
            const reportsSection = document.getElementById('reportsSection');

            // Tab switching functionality
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabs = document.querySelectorAll('.tab');

            tabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const tabId = link.getAttribute('data-tab');

                    // Remove active class from all tab links
                    tabLinks.forEach(link => link.classList.remove('active'));

                    // Add active class to clicked tab link
                    link.classList.add('active');

                    // Hide all tabs
                    tabs.forEach(tab => tab.classList.remove('active'));

                    // Show selected tab
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Function to switch sections
            function switchSection(activeLink, activeSection) {
                // Remove active class from all links
                document.querySelectorAll('.sidebar-nav li a').forEach(link => link.classList.remove('active'));

                // Hide all sections
                dashboardSection.classList.add('hidden');
                addGradesSection.classList.add('hidden');
                reportsSection.classList.add('hidden');

                // Activate selected link and show selected section
                activeLink.classList.add('active');
                activeSection.classList.remove('hidden');
            }

            // Event listeners for sidebar links
            dashboardLink.addEventListener('click', () => switchSection(dashboardLink, dashboardSection));
            addGradesLink.addEventListener('click', () => switchSection(addGradesLink, addGradesSection));
            reportsLink.addEventListener('click', () => switchSection(reportsLink, reportsSection));
        });


                // dashboard.html or your JavaScript fi
        async function fetchGrades() {
            try {
                const response = await fetch('/get-grades/' + encodeURIComponent(studentIDNumber), {
                    method: 'GET',
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    displayGrades(data.gradeDataArray);
                } else {
                    console.error('Failed to fetch grades:', data.message);
                }
            } catch (error) {
                console.error('Error fetching grades:', error);
            }
        }

        function displayGrades(gradeDataArray) {
            const gradesTableBody = document.getElementById('gradesTableBody');
            gradesTableBody.innerHTML = '';

            gradeDataArray.forEach(grade => {
                const row = `<tr>
                <td>${escapeHTML(grade.courseID)}</td>
                <td>${escapeHTML(grade.courseDescription)}</td>
                <td>${escapeHTML(grade.midtermGrade)}</td>
                <td>${escapeHTML(grade.transmutedMidtermGrade)}</td>
                <td>${escapeHTML(grade.finalGrade)}</td>
                <td>${escapeHTML(grade.totalFinalGrade)}</td>
                </tr>`;
                gradesTableBody.innerHTML += row;
            });
        }

        // Perform search
        async function performSearch() {
            currentPage = 1; // Reset to the first page on a new search
            const searchInput = document.getElementById('searchInput').value;
            const searchQuery = searchInput.trim();
            
            // Check if the search query is empty
            if (!searchQuery) {
                alert('Please enter a search query.');
                return;
            }
            try {
                    // Send search request to the server
                    const response = await fetch(`/search?query=${encodeURIComponent(searchQuery)}`, {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include' // Include credentials for session handling
                    });

                    if (!response.ok) {
                        throw new Error('Failed to perform search.');
                    }

                    const data = await response.json();

                    if (data.success) {
                        // Update the table with results
                        displayResults(data.results);
                        setupPagination(searchResultsData);
                        displayPage(currentPage);
                    } else {
                        console.error('No results found:', data.message);
                        document.getElementById('searchResults').innerHTML = `<p class="no-results">${data.message}</p>`;
                    }
                } catch (error) {
                    console.error('Error performing search:', error);
                }
            }
  




        // Event listeners for search button and Enter key
        document.getElementById('searchButton').addEventListener('click', performSearch);
        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Display search results in a table
        function displayResults(results) {
            searchResultsData = results; // Store results for pagination
            setupPagination(results);
            displayPage(currentPage);
        }

        function displayPage(page) {
            const tableBody = document.getElementById('searchResults');
            tableBody.innerHTML = '';

            const startIndex = (page - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const paginatedResults = searchResultsData.slice(startIndex, endIndex);

            if (paginatedResults.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="no-results">No results found.</td></tr>';
                return;
            }

            paginatedResults.forEach(result => {
                const row = `<tr>
            <td>${escapeHTML(result.studentIDNumber) || 'N/A'}</td>
            <td>${escapeHTML(result.firstName)} ${escapeHTML(result.lastName)}</td>
            <td>${escapeHTML(result.CourseID) || 'N/A'}</td>
            <td>${escapeHTML(result.CourseDescription) || 'N/A'}</td>
            <td>${escapeHTML(result.MG) || 'N/A'}</td>
            <td>${escapeHTML(result.transmutedMidtermGrade) || 'N/A'}</td>
            <td>${escapeHTML(result.FG) || 'N/A'}</td>
            <td>${escapeHTML(result.totalFinalGrade) || 'N/A'}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

    
        // Logout functionality
        document.getElementById('logoutLink').addEventListener('click', function (event) {
            event.preventDefault();
    
            fetch('/logout', {
                method: 'POST',
                credentials: 'include' // Include credentials for session handling
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = 'login.html'; // Redirect to login page
                } else {
                    console.error('Logout failed');
                }
            })
            .catch(error => {
                console.error('Error during logout:', error);
            });
        });

        document.getElementById('uploadForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            
        const formData = new FormData(this);
        const xhr = new XMLHttpRequest();

        // Show the progress bar
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('uploadProgress');
        const progressText = document.getElementById('progressText');
        progressContainer.style.display = 'block';

        xhr.open('POST', '/upload-grades', true);

        // Monitor progress
        xhr.upload.addEventListener('progress', function (event) {
            if (event.lengthComputable) {
                const percentComplete = Math.round((event.loaded / event.total) * 100);
                progressBar.value = percentComplete;
                progressText.textContent = `${percentComplete}%`;
            }
        });

        // Handle completion
        xhr.onload = function () {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (response.success) {
                    alert('Grades uploaded successfully!');
                } else {
                    alert('Failed to upload grades: ' + response.message);
                }
            } else {
                alert('An error occurred during the upload.');
            }
            // Reset progress bar
            progressBar.value = 0;
            progressText.textContent = '0%';
            progressContainer.style.display = 'none';
        };

        // Handle errors
        xhr.onerror = function () {
            alert('An error occurred during the upload.');
            progressBar.value = 0;
            progressText.textContent = '0%';
            progressContainer.style.display = 'none';
        };

        // Send the form data
        xhr.send(formData);


            try {
                const response = await fetch('/upload-grades', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include' // Ensure session is maintained
                });

                const result = await response.json();

                if (result.success) {
                    alert('Grades uploaded successfully!');
                } else {
                    alert('Failed to upload grades: ' + result.message);
                }
            } catch (error) {
                console.error('Error uploading grades:', error);
                alert('An error occurred while uploading grades.');
            }
        });

    async function uploadGrades(file) {
    try {
        const formData = new FormData();
        formData.append('gradesFile', file);

        const response = await fetch('/upload-grades', {
            method: 'POST',
            body: formData,
            credentials: 'include' // Include cookies for session-based auth
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('Upload response:', result);

        if (result.success) {
            alert('Grades uploaded successfully!');
        } else {
            console.error('Failed to upload grades:', result.message);
        }
    } catch (error) {
        console.error('Error uploading grades:', error);
    }
}

    let currentPage = 1;
    const rowsPerPage = 5; // Adjust as needed
    let searchResultsData = [];



    function setupPagination(results) {
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = ''; // Clear previous buttons

    const totalPages = Math.ceil(results.length / rowsPerPage);

    // Create First Button
    const firstButton = createPaginationButton('First', 1, currentPage === 1);
    paginationContainer.appendChild(firstButton);

    // Create Previous Button
    const prevButton = createPaginationButton('Previous', currentPage - 1, currentPage === 1);
    paginationContainer.appendChild(prevButton);

    // Create Next Button
    const nextButton = createPaginationButton('Next', currentPage + 1, currentPage === totalPages);
    paginationContainer.appendChild(nextButton);

    // Create Last Button
    const lastButton = createPaginationButton('Last', totalPages, currentPage === totalPages);
    paginationContainer.appendChild(lastButton);
}

function createPaginationButton(label, targetPage, disabled) {
    const button = document.createElement('button');
    button.textContent = label;
    button.disabled = disabled;

    button.addEventListener('click', () => {
        if (!disabled) {
            currentPage = targetPage;
            displayPage(currentPage); // Update displayed results
            setupPagination(searchResultsData); // Update button states
        }
    });

    return button;
}

// Function to escape HTML to prevent XSS
function escapeHTML(text) {
    if (!text) return text;
    return text.replace(/[&<>"'`=\/]/g, function (char) {
        return {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            '/': '&#x2F;',
            '`': '&#x60;',
            '=': '&#x3D;'
        }[char];
    });
}

document.getElementById('attendanceUploadForm').addEventListener('submit', async function (event) {
    event.preventDefault();

    const formData = new FormData(this); // Automatically includes the term input

    const xhr = new XMLHttpRequest();

    // Show the progress bar
    const progressContainer = document.getElementById('attendanceProgressContainer');
    const progressBar = document.getElementById('attendanceUploadProgress');
    const progressText = document.getElementById('attendanceProgressText');
    progressContainer.style.display = 'block';

    xhr.open('POST', '/upload-attendance', true);

    // Monitor progress
    xhr.upload.addEventListener('progress', function (event) {
        if (event.lengthComputable) {
            const percentComplete = Math.round((event.loaded / event.total) * 100);
            progressBar.value = percentComplete;
            progressText.textContent = `${percentComplete}%`;
        }
    });

    // Handle completion
    xhr.onload = function () {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            if (response.success) {
                alert('Attendance uploaded successfully!');
            } else {
                alert('Failed to upload attendance: ' + response.message);
            }
        } else {
            alert('An error occurred during the upload.');
        }
        // Reset progress bar
        progressBar.value = 0;
        progressText.textContent = '0%';
        progressContainer.style.display = 'none';
    };

    // Handle errors
    xhr.onerror = function () {
        alert('An error occurred during the upload.');
        progressBar.value = 0;
        progressText.textContent = '0%';
        progressContainer.style.display = 'none';
    };

    // Send the form data
    xhr.send(formData);
});



    </script>
    
</body>
</html>
