document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('eventForm');
  const statusDiv = document.getElementById('eventStatus');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X5E3N182NE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-X5E3N182NE');
  </script>

  <meta charset="UTF-8">
  <meta name="author" content="Henson M. Sagorsor">
  <meta name="google-adsense-account" content="ca-pub-4537208011192461">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO Meta -->
  <meta name="description" content="View and search the CRFV Event Management System audit logs. Track user actions, system changes, and security events for your organization.">
  <meta name="keywords" content="CRFV, audit trail, logs, event management, system logs, security, user actions, reports">

  <title>CRFV Event Management System | Audit Logs</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="css/index.css">

  <link rel="stylesheet" href="css/audittrail.css">

  <!-- Google Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4537208011192461" crossorigin="anonymous"></script>

  <!-- Open Graph for sharing -->
  <meta property="og:title" content="CRFV Event Management System Audit Logs">
  <meta property="og:description" content="Track and review all system actions and changes in the CRFV Event Management System audit logs.">
  <meta property="og:image" content="https://hellograde.online/images/hellograde-blog-banner.jpg">
  <meta property="og:url" content="https://hellograde.online/crfv/audittrail.html">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="CRFV Event System">
</head>
<body>
  
        <header class="fixed-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="header-title" style="display: flex; align-items: center;">
                    <a href="/crfv/index.html" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
                    <i class="material-icons" aria-hidden="true">event</i>
                    <span style="margin-left: 0.5em;">CRFV Event Management System | Audit Logs</span>
                    </a>
            </div>
            <div class="header-right" style="display: flex; justify-content: center; align-items: center; gap: 1em;">
                <div id="clock" aria-live="polite"></div>
                <button id="logoutBtn" class="btn btn-logout" aria-label="Logout">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
                </button>
            </div>
            </header>
            <details class="brand" style="margin-bottom:1.5em;">
  <summary style="font-size:1.2em; font-weight:600; color:#2c3e50; cursor:pointer;">
    Audit Trail Logs
  </summary>
  <div style="margin-top:0.7em;">
    <p style="margin:0; color:#555;">
      Welcome to the Audit Trail Logs for the CRFV Event Management System.<br>
      Here, you can monitor, search, and filter every action performed within the systemâ€”helping you ensure transparency and security.<br>
      <br>
      <b>Features:</b><br>
      &bull; <b>Search</b> by user, role, action, or details.<br>
      &bull; <b>Filter</b> logs by date range and adjust the number of results per page.<br>
      &bull; <b>Sort</b> columns by clicking their headers.<br>
      &bull; <b>Export</b> filtered or complete logs for reporting and compliance.<br>
      <br>
      Use these tools to track user activities, system changes, and security events for your organization.
    </p>
  </div>
</details>

        </div>
        <div class="main-menu" style="margin-top:2em;">

      <!-- Logs Tab -->
      <div class="tab-content" id="tab-logs">
        <div class="search-bar-controls">
          <input type="text" id="searchLogs" placeholder="Search logs..." style="flex:2; min-width:160px;">

          <select id="logsLimit" style="flex:1; min-width:90px;">
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="250">250</option>
            <option value="500">500</option>
            <option value="1000">1000</option>
            <option value="all">All</option>
          </select>
          <input type="date" id="dateFrom" title="From date" style="flex:1; min-width:120px;">
          <input type="date" id="dateTo" title="To date" style="flex:1; min-width:120px;">
        </div>
        <div class="results-export-row">
            <div id="logsResultsSummary"></div>
            <div class="inline-pagination" id="inlinePagination"></div>
            <div class="export-controls">
                <select id="exportType">
                <option value="filtered">Export Filtered</option>
                <option value="all">Export All</option>
                </select>
                <button id="exportBtn" class="btn" type="button">
                <i class="fas fa-file-export"></i> Export
                </button>
            </div>
            </div>

        <div class="table-container">
          <table id="logs-table">
            <thead>
              <tr>
                <th data-field="user_name" class="sortable">User <span></span></th>
                <th data-field="user_role" class="sortable">Role <span></span></th>
                <th data-field="action" class="sortable">Action <span></span></th>
                <th data-field="action_time" class="sortable">Time <span></span></th>
                <th data-field="ip_address" class="sortable">IP Address <span></span></th>
                <th data-field="details" class="sortable">Details <span></span></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="logsPagination" class="pagination" style="margin-top: 1em; text-align: center;"></div>
      </div>





  <div id="loadingSpinner" style="display:none;text-align:center;margin:2em 0;">
  <i class="fas fa-spinner fa-spin fa-2x"></i>
</div>
  <div style="position:fixed;bottom:100px;right:0;z-index:1000;width:320px;max-width:100%;">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-format="fluid"
       data-ad-layout-key="-gw-3+1f-3d+2z"
       data-ad-client="ca-pub-4537208011192461"
       data-ad-slot="1905924631"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/audittrail.js"></script>
  <!-- You will add your JS logic for tabs, search, pagination, export, and authentication here -->
  

</body>
  <!-- Footer Section -->
  <div id="footer"></div>
  <script>
    fetch('/crfv/footer.html')
      .then(res => res.text())
      .then(html => document.getElementById('footer').innerHTML = html);
  </script>


</html>

      event_name: form.event_name.value.trim(),
      event_date: form.event_date.value,
      location: form.location.value.trim()
    };
    statusDiv.textContent = "Creating event...";
    try {
      const res = await fetch('/api/events', {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();
      if (result.status === "success") {
        statusDiv.textContent = "Event created!";
        form.reset();
        loadLatestEvents();
      } else {
        statusDiv.textContent = result.message || "Event creation failed.";
      }
    } catch {
      statusDiv.textContent = "Network error. Please try again.";
    }
  });

  async function loadLatestEvents() {
    const res = await fetch('/api/events/latest');
    const events = await res.json();
    const list = document.getElementById('latestEventsList');
    list.innerHTML = events.map(ev =>
      `<li>${ev.event_name} (${ev.event_date}) - ${ev.location}</li>`
    ).join('');
  }
  loadLatestEvents();
});
